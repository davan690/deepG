language: r
sudo: required
cache: packages
dist: trusty
warnings_are_errors: false
addons:
  apt:
    packages:
    - build-essential
    - libxml2-dev
    - autoconf
    - libtool
    - subversion
    - libmagick++-dev
    - python3-dev
    - python3-pip
    - python3-virtualenv
    - python3-venv
env:
  global:
  - PKG_CFLAGS="-pedantic"
  - _R_CHECK_CRAN_INCOMING_=FALSE
  - ASAN="-fsanitize=address -fno-omit-frame-pointer"
  - HDF5_RELEASE_URL="https://support.hdfgroup.org/ftp/HDF5/releases"
  - LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib
  - CODECOV_TOKEN="e2914fef-6e65-4145-b931-03d31277099f"
  - secure: TR93h4r1eTsjpMqd2FwYcqe4r9ERBWCTss9r8fEF4sIYUkUYduEsVK04PzLO1Sx6t1lQ1bgelrUig7FCc0Hhjwgz+afu1s28E3kccnRUWYAZCEX6zamLWlHuTw0N79nnv7iZGud+k7eeel/Xpn2b8CF+/5I7bnrtjpicPS445Au26qc2/nBXaxf6WRw1XOmyKmGY9N952QqZHXAMFJN90MUEnf/XxnCG5Xwe2PxLyOSW1/5eQPZcVJfOg90cdAF+66aPe4ko8JYMkvINMvzMxIM9NH273V/KUsRH3Nu1EhVT6OmM1XpJMMCmG0w8n/HQss5yrf8nzR0abvb7b3hYFDQfeGcYYQ8V+Fy3UT8U1/XlbxXnvOZqyv/FDIeZQjw3Z2KDnxy9zWnoqHuZO9lq55lvHWkzIiaSB2bLs9AZaBJS7j7MW7P8KIWqD8a5IRMTc4f680hRcs2fqcTdE0o/uI3whkUni4RDikBLgv8aCBthwRefGSxs+k2J21K7HAaTk7+TBMDZMu4vsSkjut1hXVy7uC+DMEwydzsmWxQnKi/GOhUwHFEg7M0BqUyngjTKFXLOLZH5RzdvvIsw5rLFRMot+Rk1SMqxtfu7LYNggik0FikyznmEnsvhlm6et5v5plto6OIHYCWcDQRsIKaw1GnwjFwMW5pBUyHFLMs5Pe8=
  matrix:
  - HDF5_VERSION=1.10.1
matrix:
  exclude:
  - os: osx
  include:
  - os: osx
    env: HDF5_VERSION=1.10.1
  fast_finish: true
before_install:
- chmod +x travis_setup.sh
- "./travis_setup.sh"
- R -e "install.packages(c('hdf5r', 'devtools','pkgload', 'pkgdown', 'covr'))"
before_script:
- python3 -m pip install --upgrade --ignore-installed --user travis virtualenv
- R CMD INSTALL .
- R -e 'tensorflow::install_tensorflow(version = 1.14, extra_packages="IPython")'
- R -e 'tensorflow::tf_config()'
- R --no-save <<< 'pkgload::load_all(); devtools::document()'
after_success:
- if [[ "$TRAVIS_PULL_REQUEST" == "false" && "$TRAVIS_BRANCH" == "master" && "$TRAVIS_EVENT_TYPE"
  != "cron" ]] ; then R --no-save <<< "devtools::install(); pkgdown::build_site()";
  git checkout master; export TRAVIS_COMMIT_MSG="$(git log --format=%B --no-merges
  -n 1)"; git config --global user.name "Travis CI"; git config --global user.email
  "$COMMIT_AUTHOR_EMAIL"; git config credential.helper "store --file=.git/credentials";
  echo "https://${GH_TOKEN}:@github.com" >> .git/credentials; git config push.default
  matching; git add --force man/*; git add --force README.md; git add --force docs/*;
  git rm -r --cached $(find . -type d -name "*_cache"); git commit man DESCRIPTION
  NAMESPACE README.md docs -m "update auto-generated documentation [ci]" -m "$TRAVIS_COMMIT_MSG"
  || true; git push; fi;
- Rscript -e 'covr::codecov()'
notifications:
  slack: bifo-hzi:LlCI7DQETUjGybPppKUfGJCA
  on_success: never
  on_failure: always

language: r
sudo: required
cache: packages
dist: trusty
warnings_are_errors: false

addons:
  apt:
    packages:
      - build-essential
      - libxml2-dev
      - autoconf
      - libtool
      - subversion
      - libmagick++-dev
env:
  global:
  - PKG_CFLAGS="-pedantic"
  - _R_CHECK_CRAN_INCOMING_=FALSE
  - ASAN="-fsanitize=address -fno-omit-frame-pointer"
  - HDF5_RELEASE_URL="https://support.hdfgroup.org/ftp/HDF5/releases"
  - LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/lib
  - CODECOV_TOKEN="e2914fef-6e65-4145-b931-03d31277099f"
  matrix:
  - HDF5_VERSION=1.10.1

matrix:
  exclude:
    - os: osx
  include:
    - os: osx
      env: HDF5_VERSION=1.10.1
  fast_finish: true

before_install:
  - chmod +x travis_setup.sh
  - ./travis_setup.sh
  - R -e "install.packages(c('hdf5r', 'devtools','pkgload', 'pkgdown', 'covr'))"

before_script:
  - R --no-save <<< 'pkgload::load_all(); devtools::document()'

after_success:
  - R --no-save <<< "devtools::install(); pkgdown::build_site()";'
  - Rscript -e 'covr::codecov()'

notifications:
  email: philipp.muench@helmholtz-hzi.de
